language: cpp
matrix:
  include:
  - os: linux
    env: PYTHON=2.7
    dist: xenial
  - os: linux
    env: PYTHON=3.7
    dist: xenial
  - os: linux
    env: CONDA=2.7
    dist: xenial
  - os: linux
    env: CONDA=3.7
    dist: xenial
  - os: osx
    env: PYTHON=2.7
  - os: osx
    env: PYTHON=3.7
  - os: osx
    env: CONDA=2.7
  - os: osx
    env: CONDA=3.7
before_install:
- |
  if [ -n "$PYTHON" ]; then
    if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      export PATH="/Users/travis/Library/Python/2.7/bin:$PATH"
      if [ "${PYTHON:0:1}" = "3" ]; then
        brew install python3;
      fi
    fi
    python -m pip install --user virtualenv pytest
    virtualenv -p python${PYTHON:0:1} venv
    source venv/bin/activate
  elif [ -n "$CONDA" ]; then
    if [ "$TRAVIS_OS_NAME" = "linux" ]; then OS=Linux-x86_64; else OS=MacOSX-x86_64; fi
    wget -O miniconda.sh https://repo.continuum.io/miniconda/Miniconda${CONDA:0:1}-latest-$OS.sh
    bash miniconda.sh -b -p $HOME/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    conda config --set always_yes yes --set changeps1 no
    conda config --add channels conda-forge
    conda update -q conda
    conda install -q conda-build
  fi
install:
- |
  if [ -n "$PYTHON" ]; then
    python setup.py sdist > /dev/null
    python -m pip install --verbose dist/*.tar.gz
  elif [ -n "$CONDA" ]; then
    conda build -q conda.recipe --python=$CONDA --output-folder=build
    conda config --add channels "file://`pwd`/build"
    conda create -q -n test-environment python=$CONDA pyvinecopulib pytest
    source activate test-environment
    conda info --envs
  fi
script:
- "if [ -n \"$PYTHON\" ]; then\n  python -m pip install pytest\nelse \n  conda info
  --envs\nfi\npython -m pytest tests -r a\n"
- "PYTHON_VERSION=$(python --version)\nif [ \"${PYTHON_VERSION:7:1}\" = \"3\" ] &&
  [ \"$TRAVIS_OS_NAME\" = \"linux\" ]; then\n  pip install nbconvert jupyter_client
  ipykernel\n  python -m ipykernel install --user\n  for i in examples/*.ipynb; do
  \n    jupyter nbconvert --to markdown --stdout $i > $i.md.repo; \n    jupyter nbconvert
  --to markdown --execute --stdout $i > $i.md.travis; \n    diff $i.md.repo $i.md.travis\n
  \ done;\nfi\n"
# after_success:
# - |
#   if [ -n "$CONDA" ]; then
#     # Install the command line API for CONDA uploads
#     conda install anaconda-client
#     export ANACONDA_API_TOKEN=$CONDA_UPLOAD_TOKEN
#     anaconda upload bld-dir/**/PACKAGENAME-*.tar.bz2
#   fi
#     - |
#     # Only upload builds from tags
#     if [[ $TRAVIS_PULL_REQUEST == false && $TRAVIS_REPO_SLUG == "org/pkgname"
#           && $TRAVIS_BRANCH == $TRAVIS_TAG  && $TRAVIS_TAG != '' ]]; then
          # fi
deploy:
  provider: pypi
  user: "vinecopulib"
  # distributions: "sdist bdist_wheel"
  # skip_existing: true
  on:
    branch: shipping
    # tags: true
  password:
    secure: "eZWFq9fOptNzQg/DFw/Fhypthnv13oBbeAVtSOjN8EIXUO3ak0xlZnzvMCgldFkdpZHzvv89knnAX3TMyZQ6xLCKkegE+Byj8GOobgvhQ94p8ys/oYM/4LT3VwUCEzwOVEHbUjpZj7oapAGZ14XL9a4yioLfnsT1SPmOD6rdwcFznKKv6ANdaQcw0/1XQpPvEMhRQHZ/aCy7MBgnJV+5d7vubmaiDsTUifP//XRT+Pl+cJxINhgmeZSGyWHI1nBcfaeJ2GpnzHWio5QBCCRKwb45cB6EwUgNAyH6kYpwB1bZ5uX/W6GlC1JL/dQZ/iNP14JzqvJMeLJAEEBwn2THp7x4lcpF/aQ0VQSX7kC9szRzGG+3PvP7EaoLZ9YGhTXU/La8QjktUw8p7y/Oh1xKYooHJ9cx7iIsQre77fXNqMPwnWsRgYeYZrXdPYCqU3CS20iKT4/KQIewnMEuai/zt/hbd0iKh1cpWxxFXDddhWDYM0zVUX/eW7mtTxMSHpof0QF7RN2FnjL1NK8tdycXUyygYoQnVbh/doEzkaZb1v6f6K3grFK4J71KO176XXhmUTH+BeW75gU8uN4XgvlbdmSp9AWaQHzcFAzVgMvmdbvXvE9vOp+eqlmrK+RO2SwRjG16oyQUUC9sspWrlKr8VHu86JBdsNWa+xBfDML5XS8="
