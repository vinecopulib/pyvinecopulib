language: cpp
matrix:
  include:
  - os: linux
    env: PYTHON=2.7
    dist: xenial
  - os: linux
    env: PYTHON=3.7
    dist: xenial
  - os: linux
    env: CONDA=2.7
    dist: xenial
  - os: linux
    env: CONDA=3.7
    dist: xenial
  - os: osx
    env: PYTHON=2.7
  - os: osx
    env: PYTHON=3.7
  - os: osx
    env: CONDA=2.7
  - os: osx
    env: CONDA=3.7
before_install:
- |
  if [ -n "$PYTHON" ]; then
    if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      export PATH="/Users/travis/Library/Python/2.7/bin:$PATH"
      if [ "${PYTHON:0:1}" = "3" ]; then
        brew install python3;
      fi
    fi
    python -m pip install --user virtualenv pytest
    virtualenv -p python${PYTHON:0:1} venv
    source venv/bin/activate
  elif [ -n "$CONDA" ]; then
    if [ "$TRAVIS_OS_NAME" = "linux" ]; then OS=Linux-x86_64; else OS=MacOSX-x86_64; fi
    wget -O miniconda.sh https://repo.continuum.io/miniconda/Miniconda${CONDA:0:1}-latest-$OS.sh
    bash miniconda.sh -b -p $HOME/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    conda config --set always_yes yes --set changeps1 no
    conda config --add channels conda-forge
    conda update -q conda
    conda install -q conda-build
  fi
install:
- |
  if [ -n "$PYTHON" ]; then
    python setup.py sdist > /dev/null
    python -m pip install --verbose dist/*.tar.gz
  elif [ -n "$CONDA" ]; then
    conda build -q conda.recipe --python=$CONDA --output-folder=build
    conda config --add channels "file://`pwd`/build"
    conda create -q -n test-environment python=$CONDA pyvinecopulib pytest
    source activate test-environment
    conda info --envs
  fi
script:
- "if [ -n \"$PYTHON\" ]; then\n  python -m pip install pytest\nelse \n  conda info
  --envs\nfi\npython -m pytest tests -r a\n"
- "PYTHON_VERSION=$(python --version)\nif [ \"${PYTHON_VERSION:7:1}\" = \"3\" ] &&
  [ \"$TRAVIS_OS_NAME\" = \"linux\" ]; then\n  pip install nbconvert jupyter_client
  ipykernel\n  python -m ipykernel install --user\n  for i in examples/*.ipynb; do
  \n    jupyter nbconvert --to markdown --stdout $i > $i.md.repo; \n    jupyter nbconvert
  --to markdown --execute --stdout $i > $i.md.travis; \n    diff $i.md.repo $i.md.travis\n
  \ done;\nfi\n"
deploy:
  provider: pypi
  user: vinecopulib
  skip_existing: true
  on:
    branch: shipping
  password:
    secure: nD+J2GZANmRPEurTQfsEk+guGTHUmLvFKD3ZmvBzKek5ngEpMjAhNGrdnjC0U/LC812I93JFxbBwMpceiN6qWEOBYO+Yjwm9HktjMf8jogeFn3+AbMIFfxJxhZ0mR2Z/qKlEi755gysdbKdLDa6Q+uXGFk98BOzIKV5KZaHx77XK4Qe27qJlWQt/EkR5kkgyy++/Ayx+V3fxC+lWFHFMIsU/YIiSet0X7EGVaFJ210uZn3IbXWBZMQyOmbO3uSgfFRXJPsQBNTSkaFh1NqP32uK2VHnDbp/S/SFYc+w5MfTiv73lxDtAUGZNsPtrBUzjdS9Sd4VoPvtIgiyUkSCUUNWNhec4q9yWzq/ZQTplDAhThxWxBRXSVzcRCs1rQRB2whqZgUEQiDGdDQIVXmt8FI2+1o/DAiXxwgj7zMGeaQfiWpUwuZLr6u5CF8tmZwuasFDLcTCTcBMjwvdqWoaDw5HUIOHVi6U2tTSal7LHyNVTytg17i2+gasFXSKE/8r3xMN2IIiHyfhBsGak+XMQvrxC3C4poGi11Zzj2W9/3Jw6hUTuHgkrvDCKHHF0RcF82RcAME3OW7VL6ppYfFq/LWEj9u2lKvffQdVxxvDMTwo4dQPxc/U37xgKPXgMgSxURI8DtTmGZ7hZVRU+u78LJFxtNTZMZT17Yc0klfS+x4I=
