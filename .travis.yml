language: cpp
matrix:
  include:
  - os: linux
    env: PYTHON=2.7
    dist: xenial
  - os: linux
    env: PYTHON=3.7
    dist: xenial
  - os: linux
    env: CONDA=2.7
    dist: xenial
  - os: linux
    env: CONDA=3.7
    dist: xenial
  - os: osx
    env: PYTHON=2.7
  - os: osx
    env: PYTHON=3.7
  - os: osx
    env: CONDA=2.7
  - os: osx
    env: CONDA=3.7
before_install:
- |
  if [ -n "$PYTHON" ]; then
    if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      export PATH="/Users/travis/Library/Python/2.7/bin:$PATH"
      if [ "${PYTHON:0:1}" = "3" ]; then
        brew install python3;
      fi
    fi
    python -m pip install --user virtualenv pytest
    virtualenv -p python${PYTHON:0:1} venv
    source venv/bin/activate
  elif [ -n "$CONDA" ]; then
    if [ "$TRAVIS_OS_NAME" = "linux" ]; then OS=Linux-x86_64; else OS=MacOSX-x86_64; fi
    wget -O miniconda.sh https://repo.continuum.io/miniconda/Miniconda${CONDA:0:1}-latest-$OS.sh
    bash miniconda.sh -b -p $HOME/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    conda config --set always_yes yes --set changeps1 no
    conda config --add channels conda-forge
    conda update -q conda
    conda install -q conda-build
  fi
install:
- |
  if [ -n "$PYTHON" ]; then
    python setup.py sdist > /dev/null
    python -m pip install --verbose dist/*.tar.gz
  elif [ -n "$CONDA" ]; then
    conda build -q conda.recipe --python=$CONDA --output-folder=build
    conda config --add channels "file://`pwd`/build"
    conda create -q -n test-environment python=$CONDA pyvinecopulib pytest
    source activate test-environment
    conda info --envs
  fi
script:
- "if [ -n \"$PYTHON\" ]; then\n  python -m pip install pytest\nelse \n  conda info
  --envs\nfi\npython -m pytest tests -r a\n"
- "PYTHON_VERSION=$(python --version)\nif [ \"${PYTHON_VERSION:7:1}\" = \"3\" ] &&
  [ \"$TRAVIS_OS_NAME\" = \"linux\" ]; then\n  pip install nbconvert jupyter_client
  ipykernel\n  python -m ipykernel install --user\n  for i in examples/*.ipynb; do
  \n    jupyter nbconvert --to markdown --stdout $i > $i.md.repo; \n    jupyter nbconvert
  --to markdown --execute --stdout $i > $i.md.travis; \n    diff $i.md.repo $i.md.travis\n
  \ done;\nfi\n"
deploy:
  provider: pypi
  user: vinecopulib
  skip_existing: true
  on:
    branch: shipping
  password:
    secure: EI4up0TshUhrzTHKHJdqPKfJP0qpuh1SpabC5l3azax/GvdZ2C3GaEiRuyRVtNhATIbzwDH4X4cmjrtVCkl+7S/6gRg2xJXHyklAHyZtK8ZSsoX6JjBiWBVnCA7WL35uK7wrdXPLjlAUU+1LAmPdU2XaYr5zVvt8Bcb9AOtGcPLJtelNZJG84J1APcQOgL2LDY2GQhCnKA+Y/zxrTW0JmFb9dRg2VhML8uwyBmkWLJ3I3LXiLx+ZwisQ3YX30tu94Zb2uKM8zXENjeOa6i+NBn31PGzB2tgMJcKSBhggOnyRgDG5xvXb91Rupe0vE/NaEio6bCq5E5DuK9jURKWXF55htJOf3Mm0aq31fysZLxhJTnRkMnHFpBMTAOqNtsEky19as5nF0nhDQLI6dDJMFejJ8oETQnVMaSrYjaRfXgKms/wHC51QOr0LxmfvFv5nhX41Ofsx5tQS3nIdFyGWkeMjROit91jZxQeJH5VYx1sOvN3GgvcNjFTDWGAm+xdDLP73dKlFb1KGOCPIdGE8cT+rEKQjyTHq5s16YO85myaIEx9fthHwhKi8RwdNGCg5Wel02Oahk0FUNeyZy4loF5MwRCO+5mwVUuA1gGhMkkpTSfEXJFhnyzsgL90I+jDrXEVMKGcx4twcRk7tbm1lY4Np3fgGwRJUPw/WCtQi99k=
